---
gitea: none
include_toc: true
---

# Шованс (Show once) - сервис обмена текстами, которые доступны для чтения только один раз

## Назначение

Предоставить **Отправителю** возможность сохранить на сервере некую текстовую информацию (например, пароль) и ограничить доступ к ней единственным **адресатом**.
Цель - гарантировать, что легитимный **адресат** или будет единственным или вообще не получит доступ к информации (что будет означать утечку).

При этом на **адресата** не должно накладываться требований по безопасности (вроде наличия ЭЦП или токена), кроме визуального контроля атрибутов сертификата сервиса.

Т.о., в первой версии считается допустимым сценарий, при котором пользователь может получить фальшивый URL, пройти по ссылке и увидеть похожий сайт, который запросит информацию с легального, покажет ее пользователю и сохранит у себя.

## Атрибуты текста

* ID - уникальный идентификатор текста (UUID)
* Название - описание текста, доступное многократно
* Контент - сам текст, удаляется после первого показа
* Группа - уникальный идентификатор группы текстов
* Срок жизни контента - момент автоудаления непрочтенного контента
* Срок жизни метаданных - момент автоудаления всей информации о тексте
* Время показа - момент показа (и удаления) текста

## Алгоритм

**Отправитель** 

* авторизуется
* открывает страницу "Создать"
* вводит информацию
* нажимает "Сохранить"
* получает ссылку на доступ к информации

**Адресат**

* открывает ссылку доступа
* видит название текста, срок жизни и ссылку "Показать"
* после нажатия "Показать" - видит сам текст
* при отправке текста адресату он удаляется на сервере и формируется уведомление для **Отправителя**

**Отправитель** 

* авторизуется
* на открывшейся после авторизации странице видит список своих текстов с атрибутами
  * ссылка
  * название
  * факт показа (IP адресата) 
  * время показа (до показа - время удаления текста)
* список может быть отфильтрован по
  * факту показа
  * значению поля "Группа"

## Архитектура

### Карта сайта

Сервис представляет собой сайт со следующими страницами
* главная (/), содержит
  * описание сервиса
  * ссылку на авторизацию отправителя
  * поле ввода идентификатора текста
* метаданные текста (/item?id=XXX), содержит
  * все атрибуты текста (кроме контента)
  * ссылку "Показать" (если не было показа, иначе - время показа)
* контент (POST /item?id=XXX), содержит
  * при первом запросе - текст, иначе - 404
* кабинет отправителя (/my), доступен после авторизации и содержит
  * ссылку "создать"
  * список созданных текстов
* создание текста (/my/new), содержит
  * форму с атрибутами текста
  * кнопку "Создать"

### API

* /api/item?id=XXX - вернуть метаданные по id
* /api/item/data?id=XXX - вернуть контент по id
* /my/api/items - вернуть список своих текстов
* /my/api/new - создать контент
* /my/api/stat - общая статистика (всего/активных текстов, макс дата активного текста)

### ID

Для генерации идентификатора используется [ULID](https://github.com/oklog/ulid).
Это позволяет зашивать дату (создания или протухания)

### Уникальность секрета

Осуществляется хранением его sha1

### Хранение

Согласно юзкейса сервиса (передача пароля от админа к пользователю), повторное создание текста (генерация нового пароля) дешевле, чем потенциальный ущерб от компрометации этого текста.

Поэтому сам текст хранится только в памяти приложения и удаляется в случае

* показа получателю
* истечения срока хранения
* рестарта сервиса

Т.е. на диск тексты не пишутся, чтобы избежать шифрования, для которого придется где-то хранить ключ, который может утечь. Эта проблема, возможно, решаема с использованием таких техник, как [vault](https://github.com/hashicorp/vault), но для первой версии это принято нецелесообразным.

Вместе с тем, жизненный цикл у метаданных текста иной, информация о его судьбе должна храниться дольше (до Срока жизни метаданных), поэтому метаданные хранятся в персистентном KV-хранилище (в таблицах "uuid-атрибуты" и "отправитель-его uuid")

### Авторизация отправителя

Этот функционал пока проектируется.

Цели:

* группировка текстов по автору
* исключение нецелевого использования сервиса

Возможные варианты:

* email
* gitea
* telegram
* [gotify](https://gotify.net/)


## Дополнения

### Атрибуты

### Группа

уникальный идентификатор группы текстов первоначально формируется автоматически и указывается в форме с атрибутами текста. Отправитель может заменить это значение на любое из групп созданных им ранее текстов.

Назначение атрибута - фильтрация списка созданных текстов в кабинете
